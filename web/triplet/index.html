<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” Triplet Analyzer Module - ChainAnalyzer</title>
    <link rel="stylesheet" href="/style.css">
    <style>
        .module-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        .breadcrumb {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
        }
        .breadcrumb a {
            color: #007bff;
            text-decoration: none;
        }
        .breadcrumb a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header>
        <h1>ğŸ”— ChainAnalyzer Dashboard</h1>
        <div class="server-info">
            <span id="server-status">ğŸ”„ ì—°ê²° ì¤‘...</span>
            <span id="last-update"></span>
        </div>
    </header>

    <main>
        <!-- ë¸Œë ˆë“œí¬ëŸ¼ë¸Œ ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="breadcrumb">
            <a href="/ui/dashboard">ğŸ  í™ˆ</a> > <span>ğŸ” Triplet Analyzer</span>
        </nav>

        <!-- Triplet ëª¨ë“ˆ í—¤ë” -->
        <section class="module-header">
            <h1>ğŸ” Triplet Analyzer Module</h1>
            <p>EOA-EOA ê±°ë˜ ê´€ê³„ ë¶„ì„ ëª¨ë“ˆì…ë‹ˆë‹¤. ì´ë”ë¦¬ì›€ ì™¸ë¶€ ì†Œìœ  ê³„ì • ê°„ì˜ ê±°ë˜ íŒ¨í„´ì„ ë¶„ì„í•˜ê³  ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.</p>
        </section>

        <!-- EE ê¸°ë³¸ ìƒíƒœ -->
        <section class="overview">
            <h2>ğŸ“Š Module Status</h2>
            <div class="overview-cards">
                <div class="card">
                    <h3>Module Health</h3>
                    <div id="ee-health" class="status-indicator">Loading...</div>
                </div>
                <div class="card">
                    <h3>Processed Txs</h3>
                    <div id="ee-processed" class="metric">0</div>
                </div>
                <div class="card">
                    <h3>Success Rate</h3>
                    <div id="ee-success-rate" class="metric">0%</div>
                </div>
                <div class="card">
                    <h3>TPS</h3>
                    <div id="ee-tps" class="metric">0</div>
                </div>
            </div>
        </section>

        <!-- EE ìƒì„¸ ì •ë³´ -->
        <section class="details-grid">
            <!-- ë¶„ì„ê¸° í†µê³„ -->
            <div class="detail-card">
                <h3>ğŸ“ˆ Analyzer Statistics</h3>
                <div id="analyzer-stats" class="stats-content">
                    <div class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                </div>
            </div>

            <!-- ì±„ë„ ìƒíƒœ -->
            <div class="detail-card">
                <h3>ğŸ“¡ Channel Status</h3>
                <div id="channel-status" class="stats-content">
                    <div class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                </div>
                <div class="progress-bar">
                    <div id="channel-progress" class="progress-fill"></div>
                </div>
            </div>

            <!-- DualManager ìœˆë„ìš° -->
            <div class="detail-card">
                <h3>ğŸªŸ Window Manager</h3>
                <div id="window-stats" class="stats-content">
                    <div class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                </div>
            </div>

            <!-- GraphDB ìƒíƒœ -->
            <div class="detail-card">
                <h3>ğŸ—„ï¸ Graph Database</h3>
                <div id="graph-status" class="stats-content">
                    <div class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                </div>
            </div>
        </section>

        <!-- EE ì „ìš© ê¸°ëŠ¥ë“¤ -->
        <section class="module-features">
            <h2>ğŸ› ï¸ EE Module Features</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>ğŸ’¸ Transaction Analysis</h4>
                    <p>EOA ê°„ ê±°ë˜ íŒ¨í„´ ë¶„ì„</p>
                    <button onclick="location.href='/ui/triplet/transactions'">ê±°ë˜ ë¶„ì„</button>
                </div>
                <div class="feature-card">
                    <h4>ğŸ“Š Graph Database</h4>
                    <p>EOA ê´€ê³„ ê·¸ë˜í”„ ì¡°íšŒ</p>
                    <button onclick="location.href='/ui/triplet/graph'">ê·¸ë˜í”„ ì¡°íšŒ</button>
                </div>
                <div class="feature-card">
                    <h4>ğŸ” Debug Tools</h4>
                    <p>ëª¨ë“ˆ ë””ë²„ê¹… ë„êµ¬</p>
                    <button onclick="location.href='/ui/triplet/debug'">ë””ë²„ê·¸ ë„êµ¬</button>
                </div>
            </div>
        </section>

        <!-- API ì—”ë“œí¬ì¸íŠ¸ ì„¹ì…˜ -->
        <section class="api-section">
            <h2>ğŸ”Œ EE API Endpoints</h2>
            <div class="api-grid">
                <a href="/api/triplet/health" target="_blank" class="api-link">
                    <div class="api-card">
                        <h4>EE Health</h4>
                        <p>/api/triplet/health</p>
                    </div>
                </a>
                <a href="/api/triplet/statistics" target="_blank" class="api-link">
                    <div class="api-card">
                        <h4>EE Statistics</h4>
                        <p>/api/triplet/statistics</p>
                    </div>
                </a>
                <a href="/api/triplet/channel-status" target="_blank" class="api-link">
                    <div class="api-card">
                        <h4>Channel Status</h4>
                        <p>/api/triplet/channel-status</p>
                    </div>
                </a>
                <a href="/api/triplet/dual-manager/window-stats" target="_blank" class="api-link">
                    <div class="api-card">
                        <h4>Window Stats</h4>
                        <p>/api/triplet/dual-manager/window-stats</p>
                    </div>
                </a>
                <a href="/api/triplet/graph/stats" target="_blank" class="api-link">
                    <div class="api-card">
                        <h4>Graph Stats</h4>
                        <p>/api/triplet/graph/stats</p>
                    </div>
                </a>
            </div>
        </section>
    </main>

    <footer>
        <p>ChainAnalyzer EE Module | ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸: 2ì´ˆë§ˆë‹¤</p>
    </footer>

    <script src="/app.js"></script>
    <script>
        // EE ëª¨ë“ˆ ì „ìš© ìŠ¤í¬ë¦½íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            // EE ëª¨ë“ˆ ë°ì´í„°ë§Œ ì—…ë°ì´íŠ¸
            setInterval(updateEEData, 2000);
        });

        function updateEEData() {
            // EE ê´€ë ¨ API í˜¸ì¶œ
            updateEEHealth();
            updateEEStatistics();
            updateChannelStatus();
            updateWindowStats();
            updateGraphStatus();
        }

        function updateEEHealth() {
            fetch('/api/triplet/health')
                .then(response => response.json())
                .then(data => {
                    const healthElement = document.getElementById('ee-health');
                    if (data.healthy) {
                        healthElement.textContent = 'âœ… Healthy';
                        healthElement.className = 'status-indicator healthy';
                    } else {
                        healthElement.textContent = 'âŒ Unhealthy';
                        healthElement.className = 'status-indicator unhealthy';
                    }
                })
                .catch(error => {
                    console.error('EE Health check failed:', error);
                });
        }

        function updateEEStatistics() {
            fetch('/api/triplet/statistics')
                .then(response => response.json())
                .then(data => {
                    if (data.processed_transactions !== undefined) {
                        document.getElementById('ee-processed').textContent = data.processed_transactions.toLocaleString();
                    }
                    if (data.success_rate !== undefined) {
                        document.getElementById('ee-success-rate').textContent = (data.success_rate * 100).toFixed(1) + '%';
                    }
                    if (data.tps !== undefined) {
                        document.getElementById('ee-tps').textContent = data.tps.toFixed(2);
                    }
                    
                    // ìƒì„¸ í†µê³„ ì—…ë°ì´íŠ¸
                    const statsElement = document.getElementById('analyzer-stats');
                    statsElement.innerHTML = `
                        <div class="stat-row">
                            <span>ì²˜ë¦¬ëœ ê±°ë˜:</span>
                            <span>${data.processed_transactions?.toLocaleString() || 0}</span>
                        </div>
                        <div class="stat-row">
                            <span>ì„±ê³µë¥ :</span>
                            <span>${((data.success_rate || 0) * 100).toFixed(1)}%</span>
                        </div>
                        <div class="stat-row">
                            <span>TPS:</span>
                            <span>${(data.tps || 0).toFixed(2)}</span>
                        </div>
                    `;
                })
                .catch(error => {
                    console.error('EE Statistics fetch failed:', error);
                });
        }

        function updateChannelStatus() {
            fetch('/api/triplet/channel-status')
                .then(response => response.json())
                .then(data => {
                    const statusElement = document.getElementById('channel-status');
                    const progressElement = document.getElementById('channel-progress');
                    
                    statusElement.innerHTML = `
                        <div class="stat-row">
                            <span>ì‚¬ìš©ëŸ‰:</span>
                            <span>${data.usage}/${data.capacity}</span>
                        </div>
                        <div class="stat-row">
                            <span>ì‚¬ìš©ë¥ :</span>
                            <span>${data.usage_percent.toFixed(1)}%</span>
                        </div>
                    `;
                    
                    progressElement.style.width = data.usage_percent + '%';
                    if (data.usage_percent > 80) {
                        progressElement.className = 'progress-fill warning';
                    } else {
                        progressElement.className = 'progress-fill';
                    }
                })
                .catch(error => {
                    console.error('Channel status fetch failed:', error);
                });
        }

        function updateWindowStats() {
            fetch('/api/triplet/dual-manager/window-stats')
                .then(response => response.json())
                .then(data => {
                    const windowElement = document.getElementById('window-stats');
                    windowElement.innerHTML = `
                        <div class="stat-row">
                            <span>í˜„ì¬ ìœˆë„ìš°:</span>
                            <span>${data.current_window || 0}</span>
                        </div>
                        <div class="stat-row">
                            <span>ìœˆë„ìš° í¬ê¸°:</span>
                            <span>${data.window_size || 0}</span>
                        </div>
                        <div class="stat-row">
                            <span>ì²˜ë¦¬ëœ ì´ë²¤íŠ¸:</span>
                            <span>${data.processed_events || 0}</span>
                        </div>
                    `;
                })
                .catch(error => {
                    console.error('Window stats fetch failed:', error);
                });
        }

        function updateGraphStatus() {
            fetch('/api/triplet/graph/stats')
                .then(response => response.json())
                .then(data => {
                    const graphElement = document.getElementById('graph-status');
                    graphElement.innerHTML = `
                        <div class="stat-row">
                            <span>DB ìƒíƒœ:</span>
                            <span>${data.database_available ? 'âœ… ì‚¬ìš© ê°€ëŠ¥' : 'âŒ ì‚¬ìš© ë¶ˆê°€'}</span>
                        </div>
                        <div class="stat-row">
                            <span>ë©”ì‹œì§€:</span>
                            <span>${data.message}</span>
                        </div>
                    `;
                })
                .catch(error => {
                    console.error('Graph stats fetch failed:', error);
                });
        }
    </script>
</body>
</html>